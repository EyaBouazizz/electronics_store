<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
    <h1 class="text-center text-white display-6">Shop</h1>
    <ol class="breadcrumb justify-content-center mb-0">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Pages</a></li>
        <li class="breadcrumb-item active text-white">Shop</li>
    </ol>
</div>
<!-- Single Page Header End -->
<!-- Electronics Shop Start-->
<div class="container-fluid fruite py-5">
    <div class="container py-5">
        <h1 class="mb-4">Electronics Store</h1>
        <div class="row g-4">
            <div class="col-lg-12">
                <div class="row g-4">
                    <div class="col-xl-3">
                        <div class="input-group w-100 mx-auto d-flex">
                            <input type="search" class="form-control p-3" placeholder="Search products..." 
                                   (keyup)="searchProducts($event)">
                            <span class="input-group-text p-3"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                    <div class="col-6"></div>
                    <div class="col-xl-3">
                        <div class="bg-light ps-3 py-3 rounded d-flex justify-content-between mb-4">
                            <label for="sorting">Sort By:</label>
                            <select id="sorting" class="border-0 form-select-sm bg-light me-3" 
                                    [(ngModel)]="selectedSort" (change)="sortProducts()">
                                <option value="price_asc">Price: Low to High</option>
                                <option value="price_desc">Price: High to Low</option>
                                <option value="popularity">Popularity</option>
                                <option value="newest">New Arrivals</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-lg-3">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <div class="mb-3">
                                  <h4>Categories</h4>
                              
                                  <!-- Category Search Bar -->
                                  <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="Search categories..." 
                                           [(ngModel)]="categorySearchQuery" (input)="filterCategories()">
                                    <button class="btn btn-outline-secondary" type="button">
                                      <i class="fa fa-search"></i>
                                    </button>
                                  </div>
                              
                                  <!-- Collapsible Category List -->
                                  <ul class="list-unstyled fruite-categorie">
                                    <li *ngFor="let category of filteredCategories">
                                      <div class="d-flex justify-content-between fruite-name">
                                        <a href="javascript:void(0)" (click)="filterByCategory(category)">
                                          <i [class]="getCategoryIcon(category)"></i>{{category}}
                                        </a>
                                        <span>({{getCategoryCount(category)}})</span>
                                      </div>
                                    </li>
                                  </ul>
                              
                                  <!-- Show More/Less Button -->
                                  <div class="text-center mt-2">
                                    <a href="javascript:void(0)" class="text-primary" (click)="toggleShowAllCategories()">
                                      {{ showAllCategories ? 'Show Less' : 'Show More' }}
                                    </a>
                                  </div>
                                </div>
                              </div>
                            <div class="col-lg-12">
                                <div class="mb-3">
                                    <h4 class="mb-2">Price Range</h4>
                                    <input type="range" class="form-range w-100" min="0" max="2800" 
                                           [(ngModel)]="priceRange" (input)="filterByPrice()">
                                    <div class="d-flex justify-content-between">
                                        <span>0 DT</span>
                                        <span>{{priceRange}} DT</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="mb-3">
                                  <h4>Brands</h4>
                                  
                                  <!-- Brand Search Bar -->
                                  <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="Search brands..." 
                                           [(ngModel)]="brandSearchQuery" (input)="filterBrands()">
                                    <button class="btn btn-outline-secondary" type="button">
                                      <i class="fa fa-search"></i>
                                    </button>
                                  </div>
                              
                                  <!-- Collapsible Brand List -->
                                  <div class="brand-list">
                                    <div *ngFor="let brand of filteredBrands" class="mb-2">
                                      <input type="checkbox" class="me-2" [id]="brand" 
                                             [value]="brand" [(ngModel)]="selectedBrands[brand]"
                                             (change)="filterByBrand()">
                                      <label [for]="brand">{{brand}}</label>
                                    </div>
                                  </div>
                              
                                  <!-- Show More/Less Button -->
                                  <div class="text-center mt-2">
                                    <a href="javascript:void(0)" class="text-primary" (click)="toggleShowAllBrands()">
                                      {{ showAllBrands ? 'Show Less' : 'Show More' }}
                                    </a>
                                  </div>
                                </div>
                              </div>
                            <div class="col-lg-12">
                                <h4 class="mb-3">Featured Products</h4>
                                <div *ngFor="let featuredProduct of featuredProducts" 
                                     class="d-flex align-items-center justify-content-start mb-4">
                                    <div class="rounded me-4" style="width: 100px; height: 100px;">
                                        <img [src]="getProductImage(featuredProduct.image)"
                                             class="img-fluid rounded" alt="{{featuredProduct.productName}}">
                                    </div>
                                    <div>
                                        <h6 class="mb-2">{{featuredProduct.productName}}</h6>
                                        <div class="d-flex mb-2">
                                            <h5 class="fw-bold me-2">{{featuredProduct.price}} DT</h5>
                                            <!-- <h5 *ngIf="featuredProduct.discount" 
                                                class="text-danger text-decoration-line-through">
                                                {{featuredProduct.originalPrice}} DT
                                            </h5> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="row g-4 justify-content-center">
                          <div class="col-md-6 col-lg-6 col-xl-4" *ngFor="let product of filteredProducts">
                            <div class="rounded position-relative fruite-item d-flex flex-column h-100">
                              <!-- Product Image -->
                              <div class="fruite-img" style="height: 200px; overflow: hidden;">
                                <img [src]="getProductImage(product.image)" 
                                     class="img-fluid w-100 h-100 object-fit-cover rounded-top" 
                                     alt="{{product.productName}}">
                              </div>
                      
                              <!-- Category Label -->
                              <div class="text-black bg-light px-3 py-1 rounded position-absolute" 
                                   style="top: 10px; left: 10px;">
                                {{product.category}}
                              </div>
                      
                              <!-- Card Body -->
                              <div class="p-4 border border-secondary border-top-0 rounded-bottom flex-grow-1 d-flex flex-column">
                                <h4 class="mb-2 text-red" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{product.productName}}</h4>
                                <p class="text-gray" style="display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden;">{{product.description}}</p>
                                <div class="d-flex justify-content-between flex-lg-wrap align-items-end">
                                  <p class="text-dark fs-5 fw-bold mb-0">{{product.price}} DT</p>                               
                                  <div class="d-flex justify-content-between flex-lg-wrap">
                                    <a
                                      *ngIf="isAdmin()"
                                      class="btn border border-sec rounded-pill px-3 text-primary"
                                      data-bs-toggle="modal"
                                      data-bs-target="#editProductModal"
                                      (click)="loadProductForEdit(product)"
                                    >
                                      <i class="fa fa-edit me-2 text-primary"></i>Edit
                                    </a>
                
                                    <a
                                      *ngIf="isAdmin()"
                                      (click)="deleteProduct(product.id)"
                                      class="btn border border-sec rounded-pill px-3 text-primary"
                                    >
                                      <i class="fa fa-trash me-2 text-primary"></i>Delete
                                    </a>
                                    <div *ngIf="!isAdmin()" class="d-inline-flex align-items-center">
                                      <button
                                        (click)="addToCart(product.id, 1)"
                                        class="btn btn-md boarder border-sec rounded-pill px-3 text-primary me-2"
                                      >
                                        <i class="fa fa-shopping-bag me-2 text-primary"></i>Cart
                                      </button>
                                      <a href="javascript:void(0)" 
                                        class="btn btn-md boarder border-sec rounded-pill px-3 text-primary"
                                        data-bs-toggle="modal" 
                                        data-bs-target="#productDetailsModal"
                                        (click)="loadProductDetails(product)">
                                        <i class="fa fa-eye me-2 text-primary"></i>More
                                      </a>
                                    </div>
                                  </div>                              
                                </div>
                                <div class="mt-2">
                                  <span class="badge bg-secondary me-1">{{product.brand}}</span>
                                  <span *ngFor="let color of product.availableColors?.split(',')" 
                                        class="color-dot me-1" [style.backgroundColor]="color.trim()"></span>
                                </div>
                              </div>
                            </div>
                          </div>
                      
                          <!-- Pagination -->
                          <div class="col-12">
                            <div class="pagination d-flex justify-content-center mt-5">
                              <a href="javascript:void(0)" class="rounded" (click)="changePage(currentPage - 1)">&laquo;</a>
                              <a *ngFor="let page of pages" href="javascript:void(0)" 
                                 class="rounded" [class.active]="currentPage === page"
                                 (click)="changePage(page)">
                                {{page}}
                              </a>
                              <a href="javascript:void(0)" class="rounded" (click)="changePage(currentPage + 1)">&raquo;</a>
                            </div>
                          </div>
                        </div>
                      </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Product Details Modal -->
<div class="modal fade" id="productDetailsModal" tabindex="-1" aria-labelledby="productDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailsModalLabel">{{selectedProduct?.productName}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <!-- Image Carousel -->
        <div id="productCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
          <div class="carousel-inner">
            <!-- Main Image -->
            <div class="carousel-item active">
              <img [src]="'assets/img/' + selectedProduct?.image" 
                   class="d-block w-100 rounded" 
                   alt="{{selectedProduct?.productName}}">
            </div>
            <!-- Additional Images -->
            <div *ngFor="let image of additionalImages" class="carousel-item">
              <img [src]="'assets/img/' + image.name" 
                   class="d-block w-100 rounded" 
                   alt="{{selectedProduct?.productName}}">
            </div>
          </div>
          <!-- Carousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <!-- Product Details -->
        <div class="row">
          <div class="col-md-6">
            <p><strong>Category:</strong> {{selectedProduct?.category}}</p>
            <p><strong>Brand:</strong> {{selectedProduct?.brand}}</p>
            <p><strong>Price:</strong> {{selectedProduct?.price}} DT</p>
            <p><strong>Popularity:</strong> {{selectedProduct?.popularity}}</p>
            <p><strong>Number of Sales:</strong> {{selectedProduct?.numberOfSales}}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Available Colors:</strong></p>
            <div class="d-flex">
              <span *ngFor="let color of selectedProduct?.availableColors?.split(',')" 
                    class="color-dot me-2" [style.backgroundColor]="color.trim()"></span>
            </div>
          </div>
        </div>

        <!-- Full Description -->
        <div class="mt-4">
          <h6>Description</h6>
          <p>{{selectedProduct?.description}}</p>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>
<!-- Electronics Shop End-->