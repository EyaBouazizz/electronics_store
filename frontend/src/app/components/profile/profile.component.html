<!-- profile.component.html -->
<br>
<br>
<br>
<br>
<br>
<br>
<div class="profile-container">
    <!-- Navigation Sidebar -->
    <div class="profile-sidebar">
      <div class="profile-header">
        <img [src]="selectedPhoto || 'http://localhost:8090/uploads/' + user.photo" class="profile-img">
        <h3>{{ user.username }}</h3>
      </div>
      <nav class="profile-nav">
        <button class="nav-btn" [class.active]="activeTab === 'profile'" (click)="activeTab = 'profile'">
          <i class="fas fa-user-circle"></i> Profile Info
        </button>
        <button class="nav-btn" [class.active]="activeTab === 'orders'" (click)="activeTab = 'orders'">
          <i class="fas fa-shopping-bag"></i> Order History
        </button>
        <button class="nav-btn" [class.active]="activeTab === 'wishlist'" (click)="activeTab = 'wishlist'">
          <i class="fas fa-heart"></i> Wishlist
        </button>
        <button class="nav-btn" [class.active]="activeTab === 'password'" (click)="activeTab = 'password'">
          <i class="fas fa-lock"></i> Change Password
        </button>
        <button class="nav-btn" [class.active]="activeTab === 'preferences'" (click)="activeTab = 'preferences'">
          <i class="fas fa-cog"></i> Preferences
        </button>
        <button class="nav-btn logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </nav>
    </div>
  
    <!-- Content Area -->
    <div class="profile-content">
      <!-- Profile Info Section -->
      <div *ngIf="activeTab === 'profile'" class="tab-content">
        <h2>Profile Information</h2>
        <form [formGroup]="profileForm" class="profile-form" (ngSubmit)="saveProfile()" enctype="multipart/form-data">                        
            <div class="form-group">
                <label>Email</label>
                <input type="text" formControlName="username" readonly>
            </div>
            <div class="form-group">
              <label>Profile Picture</label>
              <div class="image-upload">
                <img [src]="selectedPhoto || 'http://localhost:8090/uploads/' + user.photo" class="current-image">
                <input type="file" (change)="onFileChange($event)" accept="image/*"  class="form-control">
              </div>
            </div>
          <button type="submit" class="btn-save">Save Changes</button>
        </form>
      </div>

      <!-- Order History Section -->
        <div *ngIf="activeTab === 'orders'" class="tab-content">
            <h2>Order History</h2>
            <div *ngIf="orders && orders.length > 0; else emptyOrders" class="order-list">
            <div *ngFor="let order of orders" class="order-card">
                <div class="order-header">
                <span class="order-date">{{order.firstName}} {{order.secondName}}</span>
                <span class="order-status">{{ order.status }}</span>
                </div>
                <div class="order-details">
                <div class="order-date">{{ order.purchaseDate | date }}</div>
                <div class="order-total">{{ order.totalPrice }} DT</div>
                </div>
                <button class="btn-details" (click)="viewOrderDetails(order.id)">View Details</button>
            </div>
            </div>
            <ng-template #emptyOrders>
            <div class="empty-orders text-center py-5">
                <div class="empty-orders-icon mb-4">
                <i class="fa fa-shopping-bag display-1 text-secondary"></i>
                </div>
                <h2 class="display-6 mb-3">No Orders Found</h2>
                <p class="mb-4 text-muted">Looks like you haven't placed any orders yet.</p>
                <button class="btn border-sec rounded-pill px-4 py-3 text-primary text-uppercase" routerLink="/">
                Start Shopping
                </button>
            </div>
            </ng-template>
        </div>
  
      <!-- Wishlist Section -->
        <div *ngIf="activeTab === 'wishlist'" class="tab-content">
            <h2>Wishlist</h2>
            <div *ngIf="wishlist && wishlist.length > 0; else emptyWishlist" class="wishlist-items">
            <div *ngFor="let item of wishlist" class="wishlist-item">
                <img [src]="'assets/img/' + item.image" alt="{{ item.productName }}" class="wishlist-item-img">
                <div class="wishlist-item-details">
                <h4>{{ item.productName }}</h4>
                <p>{{ item.price }} DT</p>
                <button
                (click)="addToCart(item.id,1)"
                  class="btn btn-md boarder border-sec rounded-pill px-3 text-primary me-2"
                >
                  <i class="fa fa-shopping-bag me-2 text-primary"></i>Cart
                </button>
                <a (click)="removeFromWishlist(item.id)" class="btn boarder border-sec rounded-pill px-3 text-primary">
                  <i class="fa fa-trash me-2 text-primary"></i>Remove
                </a>
                </div>
            </div>
            </div>
            <ng-template #emptyWishlist>
            <div class="empty-wishlist text-center py-5">
                <div class="empty-wishlist-icon mb-4">
                <i class="fa fa-heart display-1 text-secondary"></i>
                </div>
                <h2 class="display-6 mb-3">Your Wishlist is Empty</h2>
                <p class="mb-4 text-muted">Looks like you haven't added any items to your wishlist yet.</p>
                <button class="btn border-sec rounded-pill px-4 py-3 text-primary text-uppercase" routerLink="/">
                Start Shopping
                </button>
            </div>
            </ng-template>
        </div>
      
    </div>
  </div>


  <!-- Add this modal template at the bottom of profile.component.html -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="orderDetailsModalLabel">Order #{{selectedOrder?.id}}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Customer Information -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>Customer Information</h6>
              <p>{{selectedOrder?.firstName}} {{selectedOrder?.secondName}}</p>
              <p>{{selectedOrder?.address}}</p>
              <p>{{selectedOrder?.city}}, {{selectedOrder?.country}} {{selectedOrder?.postcode}}</p>
              <p>Phone: {{selectedOrder?.mobile}}</p>
              <p>Email: {{selectedOrder?.email}}</p>
            </div>
            <div class="col-md-6">
              <h6>Order Details</h6>
              <p>Payment Method: {{selectedOrder?.payment}}</p>
              <p>Status: <span class="badge" [ngClass]="{
                'bg-primary': selectedOrder?.status === 'ORDERED',
                'bg-warning': selectedOrder?.status === 'PROCESSING',
                'bg-success': selectedOrder?.status === 'DELIVERED'
              }">{{selectedOrder?.status}}</span></p>
              <p>Order Date: {{selectedOrder?.purchaseDate | date}}</p>
            </div>
          </div>
  
          <!-- Order Items -->
          <h6>Order Items</h6>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of orderItems">
                  <td>
                    <div class="d-flex align-items-center">
                      <img [src]="'assets/img/' + item.product.image" 
                           class="img-thumbnail me-2" 
                           style="width: 60px; height: 60px; object-fit: cover">
                      {{item.product.productName}}
                    </div>
                  </td>
                  <td>{{item.quantity}}</td>
                  <td>{{item.product.price}} DT</td>
                  <td>{{item.product.price * item.quantity}} DT</td>
                </tr>
              </tbody>
            </table>
          </div>
  
          <!-- Order Notes -->
          <div class="mt-3" *ngIf="selectedOrder?.notes">
            <h6>Additional Notes</h6>
            <p>{{selectedOrder?.notes}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>